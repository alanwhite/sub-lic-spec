# Certificate Authority Setup

This directory contains the Private CA infrastructure for issuing client certificates.

## Quick Start

```bash
cd ca
./docker-setup.sh
```

This will:
1. Create Root CA (offline, 20-year validity)
2. Create Intermediate CA (online, 10-year validity)
3. Generate license signing keys (separate from CA)

All operations run inside a Docker container - no OpenSSL installation required on host.

## Directory Structure

```
ca/
├── docker-setup.sh          # Master setup script
├── scripts/
│   ├── 01-setup-root-ca.sh
│   ├── 02-setup-intermediate-ca.sh
│   └── 03-generate-license-keys.sh
├── config/
│   ├── root-ca.cnf
│   └── intermediate-ca.cnf
├── root-ca/                 # Generated by scripts
│   ├── private/root-ca.key
│   └── certs/root-ca.crt
└── intermediate-ca/         # Generated by scripts
    ├── private/intermediate-ca.key
    ├── certs/
    │   ├── intermediate-ca.crt
    │   └── ca-chain.crt
    └── csr/
```

## Key Separation

- **CA Keys**: Used for certificate issuance (Root CA → Intermediate CA → Client Certs)
- **License Keys**: Used for JWT license token signing (independent lifecycle)

## Security Notes

**Development Setup:**
- Passphrases are hardcoded for ease of development
- All keys stored in repository

**Production Setup:**
- Use strong, unique passphrases
- Store Root CA private key offline
- Never commit private keys to version control
- Implement proper key rotation schedule

## Generated Files

After running `docker-setup.sh`:

- `root-ca/certs/root-ca.crt` - Root CA certificate (embed in clients)
- `intermediate-ca/certs/ca-chain.crt` - Full certificate chain (for server)
- `intermediate-ca/private/intermediate-ca.key` - Used by server for issuing client certs
- `../server/docker/license-keys/license-signing.{key,pub}` - JWT signing keys